#!/bin/sh

DWMBAR_PID=$$
#DWMBAR_SLEEP_PID=

reset_sleep() {
	pkill -P $DWMBAR_PID sleep
}

#trap '[[ $DWMBAR_SLEEP_PID ]] && echo "in EXIT" && kill "$DWMBAR_SLEEP_PID"' EXIT
trap reset_sleep 10

DWMBAR_DIR="$HOME/dwmbar/dwmbar"
delim=" "

# source modules
. "$DWMBAR_DIR/dateandtime"
. "$DWMBAR_DIR/audiocontrol"
. "$DWMBAR_DIR/internet"

get_status() {
	get_netoperstate
	get_volume
	get_dateandtime
}

while :; do
	xsetroot -name "$(get_status | tr '\n' "$delim")"
	#sleep 1m & DWMBAR_SLEEP_PID=$!
	sleep 1m &
	wait $!
	#DWMBAR_SLEEP_PID=
done
